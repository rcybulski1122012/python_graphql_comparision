"""
A hex color code string, such as #FF5733.
"""
scalar ColorCode

scalar DateTime

"""
Determines the urgency of a task.
"""
enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

"""
The specific columns available on the board.
"""
enum Column {
  TODO
  IN_PROGRESS
  REVIEW
  DONE
}

interface Node {
  id: ID!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

type User implements Node {
  id: ID!
  username: String!
  avatarColor: ColorCode
}

"""
Represents a polymorphic event in the history of a Task.
"""
interface Activity implements Node {
  id: ID!
  timestamp: DateTime!
  actor: User!
}

type CommentActivity implements Activity & Node {
  id: ID!
  timestamp: DateTime!
  actor: User!
  text: String!
}

type StatusChangeActivity implements Activity & Node {
  id: ID!
  timestamp: DateTime!
  actor: User!
  oldStatus: Column!
  newStatus: Column!
}

type Task implements Node {
  id: ID!
  title: String!
  priority: Priority!

  """
  The current column enum.
  """
  status: Column!

  """
  Calculated on-the-fly (days since creation).
  """
  daysOpen: Int!

  """
  **Authorization:** Visible only to team members.
  """
  description: String!

  """
  **Performance:** Uses DataLoader.
  """
  assignee: User

  activities: [Activity!]!
}

# --- Relay Connections ---

type TaskConnection {
  edges: [TaskEdge]
  pageInfo: PageInfo!
}

type TaskEdge {
  cursor: String!
  node: Task!
}


# --- Mutation Inpust ---

input CreateTaskInput {
  title: String!
  priority: Priority!
  status: Column!
  description: String
  assignee: ID
}

input UpdateTaskInput {
  title: String
  priority: Priority
  status: Column
  description: String
  assignee: ID
}


# --- Root Types ---

type Query {
  node(id: ID!): Node
  task(id: ID!): Task
  tasks(
    first: Int,
    after: String,
    priority: Priority,
    column: Column,
    assigneeId: ID
  ): TaskConnection
}

type Mutation {
  createTask(data: CreateTaskInput): Task!
  updateTask(id: ID!, data: UpdateTaskInput): Task!
  deleteTask(id: ID!): Task!
}

type Subscription {
  taskMoved: Task
}
